"0",""
"0","leaflet(height = 1000, width = ""100%"") %>%"
"0","  addProviderTiles(providers$CartoDB.Positron) %>%"
"0","  setView(lng = town$INTPTLON, "
"0","          lat = town$INTPTLAT,"
"0","          zoom = 16) %>%"
"0","  addPolygons(data = town,"
"0","              weight = 2,"
"0","              opacity = .5,"
"0","              color = ""black"","
"0","              fillOpacity = .01) %>%"
"0","  addLayersControl(baseGroups = c(""Pre- or Post-1991"", ""Year Category""),"
"0","                   options = layersControlOptions(collapsed = FALSE,),"
"0","                   position = ""topright"""
"0","                   ) %>%"
"0","  addCircleMarkers(data = points,"
"0","                   radius = 4,"
"0","                   weight = 2,"
"0","                   opacity = .8,"
"0","                   stroke = TRUE,"
"0","                   color = ~pal1(if1991),"
"0","                   popup = ~paste(""Address:"", situs,"
"0","                                  ""<br>Year Built:"", year,"
"0","                                  ""<br>Zoning:"", LUC"
"0","                                  ),"
"0","                   group = ""Pre- or Post-1991"""
"0","                   ) %>%"
"0","  addLegend(pal = pal1, "
"0","            data = points,"
"0","            values = ~if1991,"
"0","            group = ""Pre- or Post-1991"","
"0","            position = ""topright"","
"0","            title = ""Year Built"","
"0","            layerId = ""Pre- or Post-1991"""
"0","            ) %>%"
"0","  addCircleMarkers(data = points,"
"0","                   radius = 4,"
"0","                   weight = 2,"
"0","                   opacity = .8,"
"0","                   stroke = TRUE,"
"0","                   color = ~pal2(yearGroup),"
"0","                   popup = ~paste(""Address:"", situs,"
"0","                                  ""<br>Year Built:"", year,"
"0","                                  ""<br>Zoning:"", LUC"
"0","                                  ),"
"0","                   group = ""Year Category"""
"0","                   ) %>%"
"0","  addLegend(pal = pal2, "
"0","            data = points, "
"0","            values = ~yearGroup, "
"0","            group = ""Year Category"", "
"0","            position = ""topright"","
"0","            title = ""Year Built"","
"0","            layerId = ""Year Category"""
"0","            ) %>%"
"0","  leaflet.extras::addResetMapButton() %>%"
"0","  htmlwidgets::onRender("""
"0","    function(el, x) {"
"0","      var initialLegend = 'Pre- or Post-1991' // Set the initial legend to be displayed by layerId"
"0","      var myMap = this;"
"0","      for (var legend in myMap.controls._controlsById) {"
"0","        var el = myMap.controls.get(legend.toString())._container;"
"0","        if(legend.toString() === initialLegend) {"
"0","          el.style.display = 'block';"
"0","        } else {"
"0","          el.style.display = 'none';"
"0","        };"
"0","      };"
"0","    myMap.on('baselayerchange',"
"0","      function (layer) {"
"0","        for (var legend in myMap.controls._controlsById) {"
"0","          var el = myMap.controls.get(legend.toString())._container;"
"0","          if(legend.toString() === layer.name) {"
"0","            el.style.display = 'block';"
"0","          } else {"
"0","            el.style.display = 'none';"
"0","          };"
"0","        };"
"0","      });"
"0","    }"") #https://gist.github.com/noamross/98c2053d81085517e686407096ec0a69"
